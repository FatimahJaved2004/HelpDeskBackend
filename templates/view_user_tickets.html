{% extends 'base_dashboard.html' %}

{% block title %}{{ user.first_name }}'s Tickets{% endblock %}

{% block content %}
<h2 class="mb-4">{{ user.first_name }} {{ user.last_name }} ({{ user.employee_id }}) - Tickets</h2>

<table class="table table-striped table-hover shadow-sm">
  <thead class="table-dark">
    <tr>
      <th>#</th>
      <th>Title</th>
      <th>Status</th>
      <th>Created</th>
    </tr>
  </thead>
  <tbody>
    {% for ticket in tickets %}
    <tr class="clickable-row" onclick="window.location='{{ url_for('view_ticket', ticket_id=ticket.id) }}'">
      <td>{{ ticket.id }}</td>
      <td>
        <span
          class="text-primary"
          data-bs-toggle="popover"
          data-bs-trigger="hover focus"
          title="{{ ticket.title }}"
          data-bs-content="{{ ticket.description | e }}"
        >
          {{ ticket.title }}
        </span>
      </td>
      <td>
        <span class="badge {% if ticket.status == 'Closed' %}bg-danger{% else %}bg-success{% endif %}">
          {{ ticket.status }}
        </span>
      </td>
      <td>{{ ticket.created_at }}</td>
    </tr>
    {% else %}
    <tr>
      <td colspan="4" class="text-center text-muted">No tickets found for this user.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<a href="{{ url_for('view_users') }}" class="btn btn-secondary">Back to User List</a>

<style>
  .clickable-row {
    cursor: pointer;
  }
  .clickable-row:hover {
    background-color: #f1f1f1;
  }
</style>

<!-- Enable Bootstrap popovers -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]')
    popoverTriggerList.forEach(el => {
      new bootstrap.Popover(el, {
        trigger: 'hover',
        placement: 'top'
      });
    });
  });
</script>
{% endblock %}
